<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/admin/index.css')}}">
</head>
<body>
    
    <main>

        {% include 'admin/components/header.html' %}

        {% include 'admin/components/sidebar.html'%}

        <div class="main-content">

            <div class="page-title">
                <h2>Admin Dashboard</h2>
                <p>Overview of the system statistics and metrics</p>
            </div>

            <div class="cards">
                <div>
                    <a href="{{url_for('admin_route.user_management')}}">
                        <p class="card-title">Registered Users</p>

                        <h2 class="card-content">{{total_users}}</h2>
                    </a>

                    <p>+12% from last month</p>
                </div>

                <div>
                    <a href="#">
                        <p class="card-title">Issues Reported</p>

                        <h2 class="card-content">{{issues_reported}}</h2>
                    </a>

                    <p>283 resolved <span>47 open</span></p>
                </div>

                <div>
                    <a href="{{url_for('admin_route.plant_management')}}">
                        <p class="card-title">Total Default Plants</p>

                        <h2 class="card-content">{{default_plants}}</h2>
                    </a> 

                    <p>10 plants</p>
                </div>

                <div>
                    <a href="#">
                        <p class="card-title">Total Custom Plants</p>

                        <h2 class="card-content">{{custom_plants}}</h2>
                    </a>

                    <p>Average 4.6 plants per user</p>
                </div>

            </div>

            <div class="common-plants">

                

            </div>

            <div class="chart-container">
                <section id="plant-stats">
                    <h1>Plant Insights</h1>
                    <canvas id="plantChart"></canvas>
                </section>

                <section id="user-stats">
                    <h1>User Growth Over Time</h1>
                    <canvas id="userChart"></canvas>
                </section>
            </div>

        </div>
    
    </main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    try {
        const response = await fetch("http://127.0.0.1:5000/admin/get_user_stats");
        const data = await response.json();

        const ctx = document.getElementById("userChart").getContext("2d");

        new Chart(ctx, {
            type: "line",
            data: {
                labels: data.labels,
                datasets: [{
                    label: "Total Users",
                    data: data.counts,
                    borderColor: "#006400",  // solid dark green line
                    borderWidth: 3,
                    fill: false,             // no background fill
                    tension: 0,              // no curve → sharp angles
                    pointRadius: 0,          // removes the circles
                    pointHoverRadius: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: "top" },
                    tooltip: { enabled: true }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 10 },
                        grid: { color: "#ddd" }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    } catch (error) {
        console.error("Error loading chart data:", error);
    }

    try {
        const response = await fetch("http://127.0.0.1:5000/admin/get_default_plant_stats");
        const data = await response.json();

        const ctx = document.getElementById("plantChart").getContext("2d");

        new Chart(ctx, {
            type: "doughnut", // changed to doughnut
            data: {
                labels: data.labels,
                datasets: [{
                    data: data.counts,
                    backgroundColor: [
                        "#27A82E",
                        "#90EE90",
                        "#006400",
                        "#00311F",
                        "#66BB6A"
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: "80%", // controls the ring thickness (20% visible)
                responsive: true,
                plugins: {
                    legend: {
                        position: "bottom",
                        labels: {
                            color: "#00311F",
                            font: { size: 13 }
                        }
                    },
                    tooltip: { enabled: true }
                }
            }
        });
    } catch (error) {
        console.error("Error loading pie chart data:", error);
    }
});
    

</script>
</body>
</html>